{
    "provider": {
        "name": "Idam_api"
    },
    "consumer": {
        "name": "Annotation_api"
    },
    "interactions": [
        {
            "description": "Provider receives request to establish a session for user and returns a cookie",
            "request": {
                "method": "POST",
                "path": "/o/token"
            },
            "response": {
                "status": 200,
                "headers": {
                    "Content-Type": "application/json; charset=UTF-8"
                },
                "body": {
                    "cookie": "Idam.Session=4mTQBb9rwVUUfW3quFPLICL9BQA.*AAJTSQACMDIAAlNLABw4bmdTUnV2RHJBMUJzNDZRZGxLTFNqQWk1MkE9AAR0eXBlAANDVFMAAlMxAAIwMQ"
                },
                "matchingRules": {
                    "body": {
                        "$.cookie": {
                            "matchers": [
                                {
                                    "match": "type"
                                }
                            ],
                            "combine": "AND"
                        }
                    },
                    "header": {
                        "Content-Type": {
                            "matchers": [
                                {
                                    "match": "regex",
                                    "regex": "application/json;\\s?charset=(utf|UTF)-8"
                                }
                            ],
                            "combine": "AND"
                        }
                    }
                }
            },
            "providerStates": [
                {
                    "name": "I establish a session as a user",
                    "params": {
                        "password": "Password123",
                        "username": "emCaseOfficer"
                    }
                }
            ]
        },
        {
            "description": "Provider responds back with time bound token to Annotation API",
            "request": {
                "method": "POST",
                "path": "/o/token",
                "headers": {
                    "Content-Type": "application/json"
                }
            },
            "response": {
                "status": 200,
                "headers": {
                    "Content-Type": "application/json; charset=UTF-8"
                },
                "body": {
                    "access_token": "eyJ0eXAiOiJKV1QiLCJ6aXAiOiJOT05FI",
                    "refresh_token": "eyJ0eXAiOiJKV1QiLCJ6aXAiOiJOT05FIiwia2lkIjoiYi9PNk92V",
                    "scope": "openid roles profile",
                    "id_token": "eyJ0eXAiOiJKV1QiLCJraWQiOiJiL082T3ZWdjEre",
                    "token_type": "Bearer",
                    "expires_in": "28798"
                },
                "matchingRules": {
                    "body": {
                        "$.access_token": {
                            "matchers": [
                                {
                                    "match": "type"
                                }
                            ],
                            "combine": "AND"
                        },
                        "$.refresh_token": {
                            "matchers": [
                                {
                                    "match": "type"
                                }
                            ],
                            "combine": "AND"
                        },
                        "$.scope": {
                            "matchers": [
                                {
                                    "match": "type"
                                }
                            ],
                            "combine": "AND"
                        },
                        "$.id_token": {
                            "matchers": [
                                {
                                    "match": "type"
                                }
                            ],
                            "combine": "AND"
                        },
                        "$.token_type": {
                            "matchers": [
                                {
                                    "match": "type"
                                }
                            ],
                            "combine": "AND"
                        },
                        "$.expires_in": {
                            "matchers": [
                                {
                                    "match": "type"
                                }
                            ],
                            "combine": "AND"
                        }
                    },
                    "header": {
                        "Content-Type": {
                            "matchers": [
                                {
                                    "match": "regex",
                                    "regex": "application/json;\\s?charset=(utf|UTF)-8"
                                }
                            ],
                            "combine": "AND"
                        }
                    }
                }
            },
            "providerStates": [
                {
                    "name": "I have obtained an access_token as a user",
                    "params": {
                        "client_id": "service",
                        "client_secret": "secret",
                        "password": "Password123",
                        "redirect_uri": "http://www.service.com/callback",
                        "scope": "openid roles profile",
                        "username": "emCaseOfficer@fake.hmcts.net"
                    }
                }
            ]
        },
        {
            "description": "Provider takes user/pwd and returns Auth code to Annotation API",
            "request": {
                "method": "POST",
                "path": "/o/token",
                "headers": {
                    "Content-Type": "application/json"
                }
            },
            "response": {
                "status": 200,
                "headers": {
                    "Content-Type": "application/json; charset=UTF-8"
                },
                "body": {
                    "code": "4mTQBb9rwVUUfW3quFPLICL9BQA"
                },
                "matchingRules": {
                    "body": {
                        "$.code": {
                            "matchers": [
                                {
                                    "match": "type"
                                }
                            ],
                            "combine": "AND"
                        }
                    },
                    "header": {
                        "Content-Type": {
                            "matchers": [
                                {
                                    "match": "regex",
                                    "regex": "application/json;\\s?charset=(utf|UTF)-8"
                                }
                            ],
                            "combine": "AND"
                        }
                    }
                }
            },
            "providerStates": [
                {
                    "name": "I have obtained authorization_code as a user and a client",
                    "params": {
                        "password": "Password123",
                        "username": "emCaseOfficer"
                    }
                }
            ]
        },
        {
            "description": "Provider returns user details to Annotation API",
            "request": {
                "method": "POST",
                "path": "/details",
                "headers": {
                    "Authorization": "4mTQBb9rwVUUfW3quFPLICL9BQA"
                }
            },
            "response": {
                "status": 200,
                "headers": {
                    "Content-Type": "application/json; charset=UTF-8"
                },
                "body": {
                    "accountStatus": "active",
                    "mail": "emCaseOfficer@email.net",
                    "givenName": "emCaseOfficer",
                    "roles": "[\"citizen\"]",
                    "_id": "1234-2345-3456-4567",
                    "sn": "Jar",
                    "userName": "emCaseOfficer@email.net"
                },
                "matchingRules": {
                    "body": {
                        "$._id": {
                            "matchers": [
                                {
                                    "match": "type"
                                }
                            ],
                            "combine": "AND"
                        },
                        "$.accountStatus": {
                            "matchers": [
                                {
                                    "match": "type"
                                }
                            ],
                            "combine": "AND"
                        },
                        "$.givenName": {
                            "matchers": [
                                {
                                    "match": "type"
                                }
                            ],
                            "combine": "AND"
                        },
                        "$.sn": {
                            "matchers": [
                                {
                                    "match": "type"
                                }
                            ],
                            "combine": "AND"
                        },
                        "$.userName": {
                            "matchers": [
                                {
                                    "match": "type"
                                }
                            ],
                            "combine": "AND"
                        },
                        "$.mail": {
                            "matchers": [
                                {
                                    "match": "type"
                                }
                            ],
                            "combine": "AND"
                        },
                        "$.roles": {
                            "matchers": [
                                {
                                    "match": "type"
                                }
                            ],
                            "combine": "AND"
                        }
                    },
                    "header": {
                        "Content-Type": {
                            "matchers": [
                                {
                                    "match": "regex",
                                    "regex": "application/json;\\s?charset=(utf|UTF)-8"
                                }
                            ],
                            "combine": "AND"
                        }
                    }
                }
            },
            "providerStates": [
                {
                    "name": "a user exists",
                    "params": {
                        "email": "emCaseOfficer@email.net",
                        "forename": "emCaseOfficer",
                        "password": "Password123",
                        "roles": [
                            "citizen"
                        ],
                        "surname": "Jar"
                    }
                }
            ]
        }
    ],
    "metadata": {
        "pactSpecification": {
            "version": "3.0.0"
        },
        "pact-jvm": {
            "version": "3.5.24"
        }
    }
}